var fish;(fish=fish||{}).util={},fish.util.wrap=(t,e)=>t<0?e-Math.abs(t%e):t%e,fish.util.Vector=function(t=0,e=0){this.x=t,this.y=e,this.set=(t=0,e=0)=>{this.x=t,this.y=e},this.add=(t,e=1)=>{this.x+=t.x*e,this.y+=t.y*e},this.wrap=t=>{this.x=fish.util.wrap(this.x,t.x),this.y=fish.util.wrap(this.y,t.y)}},fish.util.Rect=class{constructor(t=0,e=0,i=0,s=0){this.pos=new fish.util.Vector(t,e),this.size=new fish.util.Vector(i,s)}copy(){return new fish.util.Rect(this.x,this.y,this.w,this.h)}shrink(t){this.pos.x+=t,this.pos.y+=t,this.size.x-=2*t,this.size.y-=2*t}get x(){return this.pos.x}get y(){return this.pos.y}get w(){return this.size.x}get h(){return this.size.y}get r(){return this.pos.x+this.size.x}get t(){return this.pos.y+this.size.y}},fish.util.loadText=async function(t){return await new Promise((e,i)=>{let s=new XMLHttpRequest;s.onreadystatechange=function(){4==this.readyState&&(200==this.status?e(this.responseText):i(`couldn't get file '${t}', response code ${this.status}`))},s.open("GET",t,!0),s.send()})},fish.util.fitText=(t,e,i)=>{console.log(i);let s="",r=t.split(/\n\n+/);for(let t of r){let r=0,n=t.split(/\s/);for(let t of n){if(0==t.length)continue;let n=(t.length-1)*e.getHorizontalPadding();for(let i=0;i<t.length;i++)n+=e.getWidth(t.charAt(i));r+n>i?(s+="\n"+t,r=n):(s+=t,r+=n),r+=e.getWidth(" "),s+=" "}s+="\n"}return s},fish.util.textHeight=(t,e)=>{let i=t.split(/\n(?=\S+)/).length;return i*e.getLineHeight()+(i-1)*e.getVerticalPadding()},(fish=fish||{}).graphics={},fish.graphics.Texture=function(t,e,i){this.getGlTexture=()=>t,this.getWidth=()=>e,this.getHeight=()=>i},fish.graphics.Atlas=function(){let t={};this.add=(e,i)=>{t[e]=i},this.get=e=>e in t?t[e]:(console.error("unknown sprite name "+e),new fish.util.Rect(0,0,0,0)),this.getPatch=(t,e=0)=>{let i=this.get(t);if(e<=0){let i=t.match(/\d+/);if(!i)throw new Error("fish.graphics.Atlas.getPatch requires a border number or a sprite with a name that ends with a number");e=parseInt(i[0])}return new fish.graphics.Patch(i,e)},this.n=()=>Object.keys(t).length,this.forEach=e=>{for(let i in t)e(i,t[i])}},fish.graphics.Colour=function(t=1,e=1,i=1,s=1){this.r=t,this.g=e,this.b=i,this.a=s},fish.graphics.BitmapFont=class{constructor(t){this.sprite=t}getHorizontalPadding(){return 0}getVerticalPadding(){return 0}getWidth(t){return this.sprite.w/16}getLineHeight(){return this.sprite.h/16}},fish.graphics.loadTexture=async function(t,e){return await new Promise((i,s)=>{const r=new Image;r.onload=()=>{const e=t.createTexture();t.activeTexture(t.TEXTURE1),t.bindTexture(t.TEXTURE_2D,e),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,r),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),i(new fish.graphics.Texture(e,r.width,r.height))},r.onerror=()=>{s("failed loading image "+e)},r.src=e})},fish.graphics.loadAtlas=async function(t){let e=await fish.util.loadText(t);if(null==e)return null;let i=JSON.parse(e),s=new fish.graphics.Atlas;for(let t in i){let e=i[t];s.add(t,new fish.util.Rect(e.x,e.y,e.width,e.height))}return s},fish.graphics.Patch=class{constructor(t,e){let i=t.w-2*e,s=t.h-2*e;if(i<1||s<1)throw`${e} is too wide a border for ${t.w},${t.h}`;this.BORDER=e,this.TL=new fish.util.Rect(t.x,t.y,e,e),this.T=new fish.util.Rect(t.x+e,t.y,i,e),this.TR=new fish.util.Rect(t.x+e+i,t.y,e,e),this.ML=new fish.util.Rect(t.x,t.y+e,e,s),this.M=new fish.util.Rect(t.x+e,t.y+e,i,s),this.MR=new fish.util.Rect(t.x+e+i,t.y+e,e,s),this.BL=new fish.util.Rect(t.x,t.y+e+s,e,e),this.B=new fish.util.Rect(t.x+e,t.y+e+s,i,e),this.BR=new fish.util.Rect(t.x+e+i,t.y+e+s,e,e)}},fish.graphics.PatchRenderer=class{renderPatch(t,e){throw new Error("fish.graphics.PatchRenderer.renderPatch must be implemented")}renderCharacter(t,e,i){throw new Error("fish.graphics.PatchRenderer.renderCharacter must be implemented")}renderText(t,e,i){throw new Error("fish.graphics.PatchRenderer.renderText must be implemented")}},fish.graphics.SpriteRenderer=function(t){let e=new fish.util.Rect;t.disable(t.DEPTH_TEST),t.enable(t.BLEND),t.blendFunc(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA),this.width=t.drawingBufferWidth,this.height=t.drawingBufferHeight,this.Batch=function(i,s){let r=new Float32Array(12*s),n=new Float32Array(12*s),h=0,o=!1;const a=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,a),t.bufferData(t.ARRAY_BUFFER,r,t.DYNAMIC_DRAW);const l=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,l),t.bufferData(t.ARRAY_BUFFER,n,t.DYNAMIC_DRAW),this.addComp=(t,e,i,o,a)=>{if(h>=s)return;const l=12*h;r[l]=e,r[l+1]=i,r[l+2]=o,r[l+3]=i,r[l+4]=e,r[l+5]=a,r[l+6]=o,r[l+7]=i,r[l+8]=o,r[l+9]=a,r[l+10]=e,r[l+11]=a,n[l]=t.x,n[l+1]=t.t,n[l+2]=t.r,n[l+3]=t.t,n[l+4]=t.x,n[l+5]=t.y,n[l+6]=t.r,n[l+7]=t.t,n[l+8]=t.r,n[l+9]=t.y,n[l+10]=t.x,n[l+11]=t.y,h++},this.add=(t,e,i=1)=>{let s,r,n,h;if(e instanceof fish.util.Rect)s=e.x,r=e.r,h=e.y,n=e.t;else{if(!(e instanceof fish.util.Vector))throw new TypeError("SpriteRenderer.Batch.add requres a Vector or a Rect");{let o=.5*i;s=e.x-t.w*o,r=e.x+t.w*o,h=e.y+t.h*o,n=e.y-t.h*o}}this.addComp(t,s,n,r,h)},this.addPatch=(t,e)=>{this.addComp(t.BL,e.x,e.y,e.x+t.BORDER,e.y+t.BORDER),this.addComp(t.B,e.x+t.BORDER,e.y,e.r-t.BORDER,e.y+t.BORDER),this.addComp(t.BR,e.r-t.BORDER,e.y,e.r,e.y+t.BORDER),this.addComp(t.ML,e.x,e.y+t.BORDER,e.x+t.BORDER,e.t-t.BORDER),this.addComp(t.M,e.x+t.BORDER,e.y+t.BORDER,e.r-t.BORDER,e.t-t.BORDER),this.addComp(t.MR,e.r-t.BORDER,e.y+t.BORDER,e.r,e.t-t.BORDER),this.addComp(t.TL,e.x,e.t-t.BORDER,e.x+t.BORDER,e.t),this.addComp(t.T,e.x+t.BORDER,e.t-t.BORDER,e.r-t.BORDER,e.t),this.addComp(t.TR,e.r-t.BORDER,e.t-t.BORDER,e.r,e.t)},this.addText=(t,i,s)=>{let r=t.getWidth("n"),n=t.getLineHeight(),h=0,o=0;e.size.set(r,n);for(let a=0;a<i.length;a++){let l=i.charCodeAt(a);10==l?(o+=n+t.getVerticalPadding(),h=0):(e.pos.set(t.sprite.x+Math.floor(l%16)*r,t.sprite.y+Math.floor(l/16)*n),this.addComp(e,s.x+h,s.y-o-n,s.x+h+r,s.y-o),h+=r+t.getHorizontalPadding())}},this.renderPatch=(t,e)=>{this.addPatch(t,e)},this.renderText=(t,e,i)=>{this.addText(t,e,i)},this.renderCharacter=(t,i,s)=>{e.size.set(t.getWidth(i),t.getLineHeight()),e.pos.set(t.sprite.x+Math.floor(i%16)*e.w,t.sprite.y+Math.floor(i/16)*e.h),this.add(e,s)},this.clear=()=>{o=!1,h=0},this.render=()=>{if(o)return void console.error("repeat batch rendering without clear");o=!0;let e=fish.shader.bindDefaultShader(t);t.bindBuffer(t.ARRAY_BUFFER,a),t.bufferSubData(t.ARRAY_BUFFER,0,r),t.vertexAttribPointer(e.position,2,t.FLOAT,!1,0,0),t.enableVertexAttribArray(e.position),t.bindBuffer(t.ARRAY_BUFFER,l),t.bufferSubData(t.ARRAY_BUFFER,0,n),t.vertexAttribPointer(e.textureCoord,2,t.FLOAT,!1,0,0),t.enableVertexAttribArray(e.textureCoord),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,i.getGlTexture()),t.uniform1i(e.sampler,0),t.uniform2f(e.invTextureSize,1/i.getWidth(),1/i.getHeight()),t.drawArrays(t.TRIANGLES,0,6*h)}},this.loadTexture=async function(e){return await fish.graphics.loadTexture(t,e)},this.clear=(e=1,i=1,s=1,r=1)=>{t.clearColor(e,i,s,r),t.clear(t.COLOR_BUFFER_BIT)},this.clearColour=t=>{this.clear(t.r,t.g,t.b,t.a)}},fish.graphics.BLACK=new fish.graphics.Colour(0,0,0,1),fish.graphics.WHITE=new fish.graphics.Colour(1,1,1,1),fish.graphics.RED=new fish.graphics.Colour(1,0,0,1),fish.graphics.GREEN=new fish.graphics.Colour(0,1,0,1),fish.graphics.BLUE=new fish.graphics.Colour(0,0,1,1),(fish=fish||{}).audio={},fish.audio.Sample=function(t,e){this.name=t,this.buffer=e},fish.audio.BasicAudio=function(t,e=2){let i=null,s=null,r="",n="",h=[],o=0,a=function(){let e=t.createBufferSource();e.connect(t.destination);let i=!1,s=0,r=null,n=0;e.onended=()=>{i=!1},this.isPlaying=()=>i,this.getStart=()=>s,this.getPriority=()=>n,this.play=(t,h)=>{i=!0,s=o,r=t,n=h,e.buffer=null,e.buffer=t.buffer,e.start(0)},this.same=t=>i&&r&&r.name==t.name,this.lesser=(t,e)=>!i||n<t||n==t&&s<e};for(let t=0;t<e;t++)h.push(new a);this.update=()=>{o++},this.playSample=(t,e=0)=>{let i=-1,s=-99999,r=0;for(let e=0;e<h.length;e++){if(h[e].same(t)&&h[e].getStart()==o)return;h[e].lesser(s,r)&&(i=e,s=h[e].getPriority(),r=h[e].getStart())}i>=0&&h[i].play(t,e)},this.playSong=e=>{r!=e.name&&(r=e.name,i&&i.stop(),i=t.createBufferSource(),i.connect(t.destination),i.buffer=e.buffer,i.loop=!0,i.start(0))},this.stopSong=()=>{r="",i&&i.stop()},this.loadSong=async function(t,e){let i=await t.getSample(e);i&&this.playSong(i)},this.playNoise=e=>{n!=e.name&&(n=e.name,s&&s.stop(),s=t.createBufferSource(),s.connect(t.destination),s.buffer=e.buffer,s.loop=!0,s.start(0))},this.stopNoise=()=>{n="",s&&s.stop()},this.loadNoise=async function(t,e){let i=await t.getSample(e);i&&this.playSong(i)},this.loadSample=async function(e){let i=new XMLHttpRequest;return i.open("GET",e,!0),i.responseType="arraybuffer",new Promise((s,r)=>{i.onload=()=>{t.decodeAudioData(i.response,t=>{s(new fish.audio.Sample(e,t))},()=>{r("Couldn't load sample "+e)})},i.send()})}},(fish=fish||{}).input={},fish.input.UI_BUTTON={UP:"UP",DOWN:"DOWN",LEFT:"LEFT",RIGHT:"RIGHT",ACCEPT:"ACCEPT",CANCEL:"CANCEL"},fish.input.UiInput=class{uiDown(t){throw new Error("fish.input.UiInput.uiDown must be implemented")}uiJustDown(t){throw new Error("fish.input.UiInput.uiJustDown must be implemented")}},fish.input.BasicInput=function(t={},e=.9){this.BUTTON={UP:"UP",DOWN:"DOWN",LEFT:"LEFT",RIGHT:"RIGHT",X:"X",Y:"Y",A:"A",B:"B",L:"L",R:"R",SELECT:"SELECT",START:"START"},t.UP||(t.UP="ArrowUp"),t.DOWN||(t.DOWN="ArrowDown"),t.LEFT||(t.LEFT="ArrowLeft"),t.RIGHT||(t.RIGHT="ArrowRight"),t.A||(t.A="Shift"),t.B||(t.B="z"),t.X||(t.X="a"),t.Y||(t.Y="x"),t.L||(t.L="d"),t.R||(t.R="c"),t.SELECT||(t.SELECT="Escape"),t.START||(t.START="Enter");let i=0,s={},r={};for(let t in this.BUTTON)r[t]=0;document.addEventListener("keydown",t=>{s[t.key]=!0}),document.addEventListener("keyup",t=>{s[t.key]=!1});let n=t=>"object"==typeof t?t.pressed:1==t,h=(t,e,s=!1)=>{s&&(e=e||r[t]>0),e?0==r[t]&&(r[t]=i):r[t]=0},o=t=>{switch(t){case fish.input.UI_BUTTON.UP:return this.BUTTON.UP;case fish.input.UI_BUTTON.DOWN:return this.BUTTON.DOWN;case fish.input.UI_BUTTON.LEFT:return this.BUTTON.LEFT;case fish.input.UI_BUTTON.RIGHT:return this.BUTTON.RIGHT;case fish.input.UI_BUTTON.ACCEPT:return this.BUTTON.A;case fish.input.UI_BUTTON.CANCEL:return this.BUTTON.B}throw t};this.update=()=>{i++;let r=navigator.getGamepads?navigator.getGamepads():navigator.webkitGetGamepads?navigator.webkitGetGamepads():[];for(let e in this.BUTTON)h(e,s[t[e]]);for(let t of r)h(this.BUTTON.A,n(t.buttons[0]),!0),h(this.BUTTON.B,n(t.buttons[1]),!0),h(this.BUTTON.X,n(t.buttons[2]),!0),h(this.BUTTON.Y,n(t.buttons[3]),!0),h(this.BUTTON.L,n(t.buttons[4]),!0),h(this.BUTTON.R,n(t.buttons[5]),!0),h(this.BUTTON.SELECT,n(t.buttons[8]),!0),h(this.BUTTON.START,n(t.buttons[9]),!0),h(this.BUTTON.UP,n(t.buttons[12])||t.axes[1]<-e,!0),h(this.BUTTON.DOWN,n(t.buttons[13])||t.axes[1]>e,!0),h(this.BUTTON.LEFT,n(t.buttons[14])||t.axes[0]<-e,!0),h(this.BUTTON.RIGHT,n(t.buttons[15])||t.axes[0]>e,!0)},this.down=t=>{if(!(t in r))throw t;return r[t]>0},this.justDown=t=>{if(!(t in r))throw t;return r[t]==i},this.uiDown=t=>this.down(o(t)),this.uiJustDown=t=>this.justDown(o(t))},(fish=fish||{}).gui={},fish.gui.Knob=class{constructor(t){this.fitted=!1,this.bounds=null,this.style=t}selectable(){return!1}fit(t,e=!0){this.bounds=t,this.fitted=!0}update(t,e,i){return null}render(t,e){throw new Error("fish.gui.knob.render must be implemented")}},fish.gui.ContainerKnob=class extends fish.gui.Knob{constructor(t,e){super(t),this.hasSelectable=!1,this.selection=0,this.children=[];for(let t of e)this.addChild(t)}selectable(){return this.hasSelectable}incrementSelection(t,e){if(0==e||!this.hasSelectable)return;t.playSample(this.style.tap);let i=Math.sign(e);for(let t=0;t<this.children.length&&0!=i;t++)this.selection+=i,this.selection<0&&(this.selection=this.children.length-1),this.selection>=this.children.length&&(this.selection=0),this.children[this.selection].selectable()&&(i=0)}addChild(t){this.children.push(t),t.selectable()&&!this.hasSelectable&&(this.hasSelectable=!0,this.selection=this.children.length-1)}},fish.gui.PanelKnob=class extends fish.gui.ContainerKnob{constructor(t,e=!1,i=[]){super(t,i),this.cancellable=e}fit(t,e=!0){let i=t.copy();i.shrink(this.style.panel.BORDER);for(let t in this.children)this.children[t].fit(i.copy(),t==this.children.length-1&&e),i.size.y-=this.children[t].bounds.h;e?super.fit(t):super.fit(new fish.util.Rect(t.x,t.y+i.h,t.w,t.h-i.h))}update(t,e,i){if(i&&this.cancellable&&t.uiDown(fish.input.UI_BUTTON.CANCEL))return null;i&&this.children.length>0&&(t.uiJustDown(fish.input.UI_BUTTON.UP)?this.incrementSelection(e,-1):t.uiJustDown(fish.input.UI_BUTTON.DOWN)&&this.incrementSelection(e,1));for(let s in this.children){let r=this.children[s].update(t,e,s==this.selection&&i);if(r)return r}}render(t,e){t.renderPatch(this.style.panel,this.bounds);for(let i in this.children)this.children[i].render(t,e&&i==this.selection)}},fish.gui.TextKnob=class extends fish.gui.Knob{constructor(t,e){super(t),this._text=e,this.fittedText="",this.origin=new fish.util.Vector}get content(){return this._text}set content(t){this._text=t,this.fitted&&this.fit(this.bounds,!1)}fit(t,e=!0){this.origin.x=t.x+1,this.origin.y=t.t-1,this.fittedText=fish.util.fitText(this._text,this.style.font,t.w-2);let i=fish.util.textHeight(this.fittedText,this.style.font)+2;t.pos.y+=t.size.y-i,t.size.y=i,super.fit(t)}render(t,e){t.renderText(this.style.font,this.fittedText,this.origin)}},fish.gui.ButtonKnob=class extends fish.gui.Knob{constructor(t,e,i=null){super(t),this.down=!1,this.result=i,this.child="string"==typeof e?new fish.gui.TextKnob(t,e):e}selectable(){return!0}fit(t,e=!0){let i=t.copy();i.shrink(this.style.button.BORDER),this.child.fit(i),e||(t.size.y=this.child.bounds.size.y+2*this.style.button.BORDER,t.pos.y=this.child.bounds.pos.y-this.style.button.BORDER),super.fit(t)}update(t,e,i){if(t.uiDown(fish.input.UI_BUTTON.ACCEPT)&&i)this.down||(this.down=!0,e.playSample(this.style.click));else if(this.down&&(this.down=!1,i))return"function"==typeof this.result?this.result.call(this):this.result;return null}render(t,e){let i=e?this.down?this.style.buttonDepressed:this.style.buttonSelected:this.style.button;t.renderPatch(i,this.bounds),this.child.render(t,e)}},fish.gui.PicKnob=class extends fish.gui.Knob{constructor(t,e,i=1,s=!1){super(t),this.sprite=e,this.scale=i,this.stretch=s}},fish.gui.HBoxKnob=class extends fish.gui.ContainerKnob{constructor(t,e=[]){super(t,e)}fit(t,e=!0){let i=t.copy(),s=0;i.size.x/=this.children.length;for(let t of this.children)t.fit(i.copy(),e),i.pos.x+=i.size.x,s=Math.max(s,t.bounds.size.y);e||(t.size.y=s),super.fit(t,e)}update(t,e,i){i&&this.children.length>0&&(t.uiJustDown(fish.input.UI_BUTTON.LEFT)?this.incrementSelection(e,-1):t.uiJustDown(fish.input.UI_BUTTON.RIGHT)&&this.incrementSelection(e,1));for(let s in this.children){let r=this.children[s].update(t,e,s==this.selection&&i);if(r)return r}}render(t,e){for(let i in this.children)this.children[i].render(t,e&&i==this.selection)}},fish.gui.TextArrayKnob=class extends fish.gui.Knob{constructor(t,e,i=1){super(t),this.spareRect=new fish.util.Rect,this.width=e,this.height=i,this.scale=new fish.util.Vector(1,1),this.array=[];for(let t=0;t<i;t++){let t=[];for(let i=0;i<e;i++)t.push(Math.floor(200*Math.random()));this.array.push(t)}}fit(t,e=!0){if(e)super.fit(t,e),this.scale.x=t.size.x/(this.width*this.style.font.getWidth("n")),this.scale.y=t.size.y/(this.height*this.style.font.getLineHeight());else{let i=this.height*this.style.font.getLineHeight();t.pos.y+=t.size.y-i,t.size.y=i,t.size.x=this.width*this.style.font.getWidth("n"),super.fit(t,e)}}render(t,e){let i=this.style.font.getWidth("n")*this.scale.x,s=this.style.font.getLineHeight()*this.scale.y;this.spareRect.size.x=i,this.spareRect.size.y=s;for(let e=0;e<this.height;e++)for(let r=0;r<this.width;r++)this.spareRect.pos.x=this.bounds.x+r*i,this.spareRect.pos.y=this.bounds.y+e*s,t.renderCharacter(this.style.font,this.array[e][r],this.spareRect)}setCharacter(t,e,i){t<0||t>=this.width||e<0||e>=this.height||(this.array[e][t]=i)}},(fish=fish||{}).Store=function(t,e){let i={},s=async function(s,r){if(!(s in i))if(r in t){let n=await t[r](e+s);i[s]=n}else console.error(r+" is a not a valid asset type"),i[s]=null;return i[s]};this.getTexture=async function(t){return await s(t,"texture")},this.getAtlas=async function(t){return await s(t,"atlas")},this.getSample=async function(t){return await s(t,"sample")}},(fish=fish||{}).shader=(()=>{let t=null,e={loadShader:(t,e,i)=>{const s=t.createShader(e);return t.shaderSource(s,i),t.compileShader(s),t.getShaderParameter(s,t.COMPILE_STATUS)?s:(console.error("Could not compiler shader: "+t.getShaderInfoLog(s)),null)},createShaderProgram:(t,i=null,s=null)=>{const r=e.loadShader(t,t.VERTEX_SHADER,i||"\n    attribute vec4 position;\n    attribute vec4 textureCoord;\n    uniform vec4 invCanvas;\n    uniform vec2 invTextureSize;\n    varying highp vec2 vTextureCoord;\n    void main() {\n        gl_Position = position * (invCanvas * vec4(2, 2, 1.0, 1.0)) - vec4(1.0, 1.0, 0, 0);\n        vTextureCoord = textureCoord.xy * invTextureSize;\n    }"),n=e.loadShader(t,t.FRAGMENT_SHADER,s||"\n    uniform sampler2D sampler;\n    varying highp vec2 vTextureCoord;\n    void main() {\n        gl_FragColor = texture2D(sampler, vTextureCoord);\n    }"),h=t.createProgram();if(t.attachShader(h,r),t.attachShader(h,n),t.linkProgram(h),!t.getProgramParameter(h,t.LINK_STATUS))return console.error("Could not init shader program: "+t.getProgramInfoLog(h)),null;const o=t.drawingBufferWidth,a=t.drawingBufferHeight;t.useProgram(h);const l=t.getUniformLocation(h,"invCanvas");return t.uniform4f(l,1/o,1/a,1,1),{program:h,position:t.getAttribLocation(h,"position"),textureCoord:t.getAttribLocation(h,"textureCoord"),invTextureSize:t.getUniformLocation(h,"invTextureSize"),invCanvas:l,sampler:t.getUniformLocation(h,"sampler")}},bindDefaultShader:i=>(null==t&&(t=e.createShaderProgram(i)),i.useProgram(t.program),t)};return e})(),(fish=fish||{}).screen={},fish.screen.Transition=class{constructor(t,e=null,i=null){this.pop=t,this.screen=e,this.message=i}},fish.screen.Screen=class{constructor(t){this.ctx=t}refresh(t){}update(t){return null}render(t){}},(fish=fish||{}).start=async function(t,e){const i=1/(t.rate?t.rate:1);let s=null;try{s=(t=>{let e=t.gfx,i=t.snd,s=t.in,r=t.loaders?t.loaders:{};if(!e){let i=t.gl;if(!i)throw new RuntimeError("In order to use the default renderer, gl argument must be provided");e=new fish.graphics.SpriteRenderer(i),r.texture||(r.texture=e.loadTexture),r.atlas||(r.atlas=fish.graphics.loadAtlas)}if(!i){let e=t.ac;if(!e)throw new RuntimeError("In order to use the default sound player, ac argument must be provided");i=new fish.audio.BasicAudio(e,t.nSamples?t.nSamples:2),r.sample||(r.sprite=i.loadSample)}if(!s){let e=t.keymap?t.keymap:{},i=t.axisThreshold?t.axisThreshold:.9;s=new fish.input.BasicInput(e,i)}return{gfx:e,snd:i,in:s,str:new fish.Store(r,t.storePrefix?t.storePrefix:"/"),usr:t.usr?t.usr:{}}})(t)}catch(t){throw alert(t+t.stack?t.stack:""),t}let r=await e(s);if(null==r)return void alert("No Starting Screen. Game Cannot Start.");let n=[r];r.refresh(),setInterval(()=>{if(n.length>0){s.snd.update(),s.in.update(),(()=>{const t=n[n.length-1].update(i);t&&(t.pop&&n.pop(),t.screen&&n.push(t.screen),n[n.length-1].refresh(t.message))})(),s.gfx.clear(0,0,0,1);for(let t in n)n[t].render(t==n.length-1)}},i)};